<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bacheca Post-it + Calendario + Taccuino</title>
  <style>
    :root{
      --btn-size: 56px;      /* dimensione pulsanti tondi */
      --safe-bottom: 24px;   /* alza un po' i bottoni da bordo per telefoni con barra */
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      height: 100vh;
      background: #fdf6e3;
      overflow: hidden;
    }

    /* BACHECA */
    .bacheca {
      position: relative;
      width: 100%;
      height: 100vh;
      background: url('https://www.transparenttextures.com/patterns/cork-board.png');
      overflow: hidden;
    }

    /* FASCE */
    .fascia {
      position: absolute;
      width: 100%;
      height: 33.33%;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding-top: 6px;
      font-weight: 800;
      letter-spacing: .5px;
      font-size: 16px;
      pointer-events: none;
      mix-blend-mode: multiply;
    }
    .urgenti {
      top: 0;
      background: linear-gradient(to bottom, rgba(244,67,54,.30), rgba(244,67,54,.10));
      border-bottom: 3px solid #e53935;
      color: #b71c1c;
    }
    .dafare {
      top: 33.33%;
      background: linear-gradient(to bottom, rgba(255,152,0,.28), rgba(255,152,0,.10));
      border-bottom: 3px solid #fb8c00;
      color: #e65100;
    }
    .trascurabili {
      bottom: 0;
      background: linear-gradient(to bottom, rgba(76,175,80,.26), rgba(76,175,80,.10));
      color: #2e7d32;
    }

    /* POST-IT */
    .postit {
      position: absolute;
      width: 80px;
      height: 80px;
      background: #fff176;
      border-radius: 8px;
      box-shadow: 0 8px 18px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.5);
      padding: 8px;
      cursor: grab;
      user-select: none;
      transform: rotate(2deg);
      transform-origin: 12px 12px; /* vicino allo spillo */
      transition: box-shadow .15s ease;
    }
    .postit:active { cursor: grabbing; }
    .postit .pin {
      position: absolute;
      top: 5px; left: 5px;
      width: 10px; height: 10px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ff9b9b, #e53935 60%, #8b1919 100%);
      box-shadow: 0 1px 2px rgba(0,0,0,.35);
      pointer-events: none;
    }
    .postit p {
      margin: 14px 0 0 0;
      font-size: 12px;
      line-height: 1.15;
      word-wrap: break-word;
      outline: none;
    }
    .postit.swing {
      animation: swing .35s ease-in-out infinite alternate;
    }
    @keyframes swing {
      from { transform: rotate(0.5deg); }
      to   { transform: rotate(3.5deg); }
    }

    /* CONTROLLI IN BASSO */
    .controls-left {
      position: absolute;
      left: 10px;
      bottom: calc(var(--safe-bottom));
      display: flex;
      gap: 10px;
      z-index: 10;
    }
    .round-btn {
      width: var(--btn-size);
      height: var(--btn-size);
      border-radius: 50%;
      border: none;
      color: #fff;
      font-size: 20px;
      display: grid;
      place-items: center;
      box-shadow: 0 8px 16px rgba(0,0,0,.25);
      cursor: pointer;
      touch-action: manipulation;
    }
    #btnClear { background: #9e9e9e; }
    #btnCestino { background: #f44336; position: relative; }
    #btnCestino.highlight { outline: 3px dashed #ffebee; }

    .controls-right {
      position: absolute;
      right: 10px;
      bottom: calc(var(--safe-bottom));
      z-index: 10;
    }
    #btnAggiungi {
      background: #2196f3;
    }

    /* ICONE IN ALTO A DESTRA */
    .icons {
      position: absolute;
      top: 10px; right: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 10;
    }
    .icon-btn {
      width: 42px;
      height: 42px;
      border-radius: 10px;
      border: none;
      background: #fff;
      font-size: 22px;
      box-shadow: 0 4px 10px rgba(0,0,0,.25);
      cursor: pointer;
      touch-action: manipulation;
    }

    /* PANNELLI */
    .panel {
      position: fixed;
      right: 10px;
      top: 58px;           /* sotto le icone in alto */
      width: 270px;
      max-height: 75vh;
      background: #fff;
      border: 2px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 10px 26px rgba(0,0,0,.35);
      padding: 10px;
      display: none;
      z-index: 20;
    }
    .panel.active { display: block; }
    .panel .panel-top {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 8px;
    }
    .panel .closeX {
      background: transparent; border: none; font-size: 20px; cursor: pointer;
    }
    .panel textarea, .panel input[type="date"] {
      width: 100%;
      font-size: 14px;
    }
    .panel textarea { min-height: 90px; resize: vertical; }

    /* TACCUINO A SCHERMO INTERO (mobile friendly) */
    .notes-full {
      position: fixed;
      left: 50%; top: 50%;
      transform: translate(-50%,-50%);
      width: min(96vw, 720px);
      height: 88vh;
      background: #fff;
      border-radius: 14px;
      border: 2px solid #ccc;
      box-shadow: 0 20px 40px rgba(0,0,0,.35);
      padding: 10px;
      display: none;
      z-index: 50;
      display: none;
    }
    .notes-full.active { display: block; }
    .notes-header {
      display: flex; align-items: center; justify-content: space-between;
      gap: 8px; margin-bottom: 8px;
    }
    .notes-header .closeX { font-size: 22px; }
    .notes-title { font-weight: 700; }
    .notes-textarea {
      width: 100%; height: calc(100% - 90px);
      resize: none;
      font-size: 15px;
      line-height: 1.35;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background: #fffef8;
    }
    .notes-controls {
      margin-top: 8px;
      display: flex; align-items: center; justify-content: space-between;
      gap: 8px;
    }
    .notes-controls .btn {
      background: #2196f3; color: #fff; border: none; border-radius: 8px;
      padding: 6px 10px; font-size: 14px; cursor: pointer;
    }
    .notes-controls .pager { font-weight: 700; }

    /* Helper per tocco: evitare scroll durante drag */
    .no-scroll { touch-action: none; }
  </style>
</head>
<body>
  <div class="bacheca" id="bacheca">
    <!-- Fasce -->
    <div class="fascia urgenti">URGENTI</div>
    <div class="fascia dafare">DA FARE</div>
    <div class="fascia trascurabili">TRASCURABILI</div>

    <!-- Controlli in basso a sinistra -->
    <div class="controls-left">
      <button id="btnClear" class="round-btn" title="Cancella tutto">‚ùå</button>
      <button id="btnCestino" class="round-btn" title="Trascina qui per eliminare">üóëÔ∏è</button>
    </div>

    <!-- Tasto + in basso a destra -->
    <div class="controls-right">
      <button id="btnAggiungi" class="round-btn" title="Nuovo post-it">‚ûï</button>
    </div>

    <!-- Icone in alto a destra -->
    <div class="icons">
      <button id="btnCalendar" class="icon-btn" title="Calendario">üìÖ</button>
      <button id="btnNotes" class="icon-btn" title="Taccuino">üìì</button>
    </div>

    <!-- Pannello Calendario -->
    <div id="calendarPanel" class="panel" aria-hidden="true">
      <div class="panel-top">
        <strong>Calendario</strong>
        <button class="closeX" id="closeCalendar" title="Chiudi">‚úñ</button>
      </div>
      <input type="date" id="data"/>
      <textarea id="notaCalendario" placeholder="Scrivi appunto per questa data..."></textarea>
      <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:8px;">
        <button id="salvaCalendario" class="btn">Salva</button>
      </div>
    </div>

    <!-- Taccuino multipagina a schermo -->
    <div id="notesPanel" class="notes-full" aria-hidden="true">
      <div class="notes-header">
        <span class="notes-title" id="titoloPagina">Taccuino ‚Äî Pagina 1</span>
        <button class="closeX" id="closeNotes" title="Chiudi taccuino">‚úñ</button>
      </div>
      <textarea id="notaTaccuino" class="notes-textarea" placeholder="Scrivi le tue idee qui..."></textarea>
      <div class="notes-controls">
        <button id="prevPage" class="btn">‚¨Ö Indietro</button>
        <span id="numeroPagina" class="pager">Pagina 1</span>
        <button id="nextPage" class="btn">Avanti ‚û°</button>
        <button id="salvaTaccuino" class="btn">üíæ Salva</button>
      </div>
    </div>
  </div>

  <script>
    /* ----------------------
       RIFERIMENTI ELEMENTI
    -----------------------*/
    const bacheca = document.getElementById('bacheca');

    // Bottoni
    const btnAggiungi = document.getElementById('btnAggiungi');
    const btnClear   = document.getElementById('btnClear');
    const btnCestino = document.getElementById('btnCestino');

    // Icone/pannelli
    const btnCalendar = document.getElementById('btnCalendar');
    const calendarPanel = document.getElementById('calendarPanel');
    const closeCalendar = document.getElementById('closeCalendar');

    const btnNotes = document.getElementById('btnNotes');
    const notesPanel = document.getElementById('notesPanel');
    const closeNotes = document.getElementById('closeNotes');

    // Calendario fields
    const dataInput = document.getElementById('data');
    const notaCalendario = document.getElementById('notaCalendario');
    const salvaCalendario = document.getElementById('salvaCalendario');

    // Taccuino multipagina
    const tArea = document.getElementById('notaTaccuino');
    const titoloPagina = document.getElementById('titoloPagina');
    const numeroPagina = document.getElementById('numeroPagina');
    const prevPage = document.getElementById('prevPage');
    const nextPage = document.getElementById('nextPage');
    const salvaTaccuino = document.getElementById('salvaTaccuino');

    /* ----------------------
       STORAGE
    -----------------------*/
    let postits = JSON.parse(localStorage.getItem('postits')) || [];
    let calendario = JSON.parse(localStorage.getItem('calendario')) || {};
    let taccuino = JSON.parse(localStorage.getItem('taccuinoMultipagina')) || {};
    let paginaCorrente = parseInt(localStorage.getItem('taccuinoPaginaCorrente') || '1', 10);

    /* ----------------------
       POST-IT
    -----------------------*/
    function creaPostit(text = '', x = 100, y = 120, rot = 2) {
      const el = document.createElement('div');
      el.className = 'postit';
      el.style.left = x + 'px';
      el.style.top  = y + 'px';
      el.style.transform = `rotate(${rot}deg)`;
      el.innerHTML = `<div class="pin"></div><p contenteditable="true"></p>`;
      el.querySelector('p').innerText = text;

      // input salva
      el.querySelector('p').addEventListener('input', salvaPostits);

      // drag
      rendiTrascinabile(el);

      bacheca.appendChild(el);
      return el;
    }

    function salvaPostits() {
      postits = [];
      document.querySelectorAll('.postit').forEach(p => {
        postits.push({
          text: p.querySelector('p').innerText,
          x: p.offsetLeft,
          y: p.offsetTop,
          rot: parseFloat((p.style.transform.match(/-?\d+(\.\d+)?/)||[2])[0])
        });
      });
      localStorage.setItem('postits', JSON.stringify(postits));
    }

    function caricaPostits() {
      (postits || []).forEach(p => creaPostit(p.text, p.x, p.y, p.rot ?? 2));
    }

    function rendiTrascinabile(elem) {
      let moving = false, offX = 0, offY = 0;

      const start = (e) => {
        moving = true;
        elem.classList.add('swing');
        document.body.classList.add('no-scroll');

        const cx = e.touches ? e.touches[0].clientX : e.clientX;
        const cy = e.touches ? e.touches[0].clientY : e.clientY;
        offX = cx - elem.offsetLeft;
        offY = cy - elem.offsetTop;

        elem.style.zIndex = 1000;
      };

      const move = (e) => {
        if (!moving) return;
        const cx = e.touches ? e.touches[0].clientX : e.clientX;
        const cy = e.touches ? e.touches[0].clientY : e.clientY;
        elem.style.left = (cx - offX) + 'px';
        elem.style.top  = (cy - offY) + 'px';

        // highlight cestino se sopra
        const trash = btnCestino.getBoundingClientRect();
        const r = elem.getBoundingClientRect();
        const intersects = !(r.right < trash.left || r.left > trash.right || r.bottom < trash.top || r.top > trash.bottom);
        btnCestino.classList.toggle('highlight', intersects);
      };

      const end = (e) => {
        if (!moving) return;
        moving = false;
        elem.classList.remove('swing');
        document.body.classList.remove('no-scroll');
        elem.style.zIndex = '';

        const trash = btnCestino.getBoundingClientRect();
        const r = elem.getBoundingClientRect();
        const intersects = !(r.right < trash.left || r.left > trash.right || r.bottom < trash.top || r.top > trash.bottom);
        if (intersects) {
          elem.remove();
        }
        btnCestino.classList.remove('highlight');
        salvaPostits();
      };

      // Mouse
      elem.addEventListener('mousedown', start);
      document.addEventListener('mousemove', move);
      document.addEventListener('mouseup', end);
      // Touch
      elem.addEventListener('touchstart', start, {passive:false});
      document.addEventListener('touchmove', move, {passive:false});
      document.addEventListener('touchend', end);
    }

    // Nuovo post-it (senza testo automatico)
    btnAggiungi.addEventListener('click', () => {
      const rot = (Math.random()*2 + 1); // 1‚Äì3 gradi
      const el = creaPostit('', window.innerWidth - 120, window.innerHeight - 180, rot);
      salvaPostits();
      el.querySelector('p').focus();
    });

    // Cancella tutto
    btnClear.addEventListener('click', () => {
      if (confirm('Cancellare tutti i post-it?')) {
        document.querySelectorAll('.postit').forEach(p => p.remove());
        postits = [];
        localStorage.removeItem('postits');
      }
    });

    /* ----------------------
       CALENDARIO (semplice)
    -----------------------*/
    function apriCalendario() {
      calendarPanel.classList.add('active');
      calendarPanel.setAttribute('aria-hidden', 'false');
      // carica eventuale nota per la data corrente del picker
      if (dataInput.value) {
        notaCalendario.value = calendario[dataInput.value] || '';
      } else {
        // set data odierna come default
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth()+1).padStart(2,'0');
        const dd = String(today.getDate()).padStart(2,'0');
        dataInput.value = `${yyyy}-${mm}-${dd}`;
        notaCalendario.value = calendario[dataInput.value] || '';
      }
    }
    function chiudiCalendario() {
      calendarPanel.classList.remove('active');
      calendarPanel.setAttribute('aria-hidden', 'true');
    }
    btnCalendar.addEventListener('click', apriCalendario);
    closeCalendar.addEventListener('click', chiudiCalendario);

    dataInput.addEventListener('change', () => {
      notaCalendario.value = calendario[dataInput.value] || '';
    });

    salvaCalendario.addEventListener('click', () => {
      if (!dataInput.value) { alert('Seleziona una data.'); return; }
      calendario[dataInput.value] = notaCalendario.value;
      localStorage.setItem('calendario', JSON.stringify(calendario));
      // feedback leggero
      salvaCalendario.textContent = '‚úÖ Salvato';
      setTimeout(() => salvaCalendario.textContent = 'Salva', 900);
    });

    /* ----------------------
       TACCUINO MULTIPAGINA
    -----------------------*/
    function apriTaccuino() {
      notesPanel.classList.add('active');
      notesPanel.setAttribute('aria-hidden','false');
      caricaPaginaTaccuino();
    }
    function chiudiTaccuino() {
      notesPanel.classList.remove('active');
      notesPanel.setAttribute('aria-hidden','true');
    }
    btnNotes.addEventListener('click', apriTaccuino);
    closeNotes.addEventListener('click', chiudiTaccuino);

    function caricaPaginaTaccuino() {
      tArea.value = taccuino[paginaCorrente] || '';
      numeroPagina.textContent = 'Pagina ' + paginaCorrente;
      titoloPagina.textContent = 'Taccuino ‚Äî Pagina ' + paginaCorrente;
      localStorage.setItem('taccuinoPaginaCorrente', String(paginaCorrente));
    }
    function salvaPaginaTaccuino() {
      taccuino[paginaCorrente] = tArea.value;
      localStorage.setItem('taccuinoMultipagina', JSON.stringify(taccuino));
      salvaTaccuino.textContent = '‚úÖ Salvato';
      setTimeout(()=> salvaTaccuino.textContent = 'üíæ Salva', 900);
    }
    salvaTaccuino.addEventListener('click', salvaPaginaTaccuino);
    prevPage.addEventListener('click', () => {
      if (paginaCorrente > 1) {
        salvaPaginaTaccuino();
        paginaCorrente--;
        caricaPaginaTaccuino();
      }
    });
    nextPage.addEventListener('click', () => {
      salvaPaginaTaccuino();
      paginaCorrente++;
      caricaPaginaTaccuino();
    });

    /* ----------------------
       AVVIO
    -----------------------*/
    caricaPostits();
  </script>
</body>
</html>
